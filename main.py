from pyray import *
from abc import ABC, abstractmethod

class Vec2:
    def __init__(self, x=0.0, y=0.0):
        self.x = x
        self.y = y

    def __add__(self, other):
        return Vec2(self.x + other.x, self.y + other.y)

    def __sub__(self, other):
        return Vec2(self.x - other.x, self.y - other.y)

    def __mul__(self, scalar):
        return Vec2(self.x * scalar, self.y * scalar)

    def __truediv__(self, scalar):
        return Vec2(self.x / scalar, self.y / scalar)

class Vec3:
    def __init__(self, x=0.0, y=0.0, z=0.0):
        self.x = x
        self.y = y
        self.z = z

    def __add__(self, other):
        return Vec3(self.x + other.x, self.y + other.y, self.z + other.z)

    def __sub__(self, other):
        return Vec3(self.x - other.x, self.y - other.y, self.z - other.z)

    def __mul__(self, scalar):
        return Vec3(self.x * scalar, self.y * scalar, self.z * scalar)

    def __truediv__(self, scalar):
        return Vec3(self.x / scalar, self.y / scalar, self.z / scalar)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      

class Entity(ABC):

    def __init__(self):
        pass

    @abstractmethod 
    def process(self, delta_time, elapsed_time):
        # Process logic for the entity
        pass

    @abstractmethod
    def render(self):
        # Render the entity
        pass

class GameTick:

    def __init__(self, game_tick_fps=24, tick_callback=None):
        self.game_tick = 0
        self.game_tick_fps = game_tick_fps
        self.game_tick_seconds_per_frame = 1.0 / self.game_tick_fps
        self.game_tick_elapsed_time = 0.0
        self.tick_callback = tick_callback

    def update(self, delta_time):
        self.game_tick_elapsed_time += delta_time
        if self.game_tick_elapsed_time >= self.game_tick_seconds_per_frame:
            self.game_tick += 1
            self.game_tick_elapsed_time = 0.0
            if self.tick_callback and callable(self.tick_callback):
                self.tick_callback(self.game_tick)


class Animation(Entity):

    def __init__(self, position: Vec2, size: Vec2, duration: float, frames: list | str = None, loop=True):
        self.position: Vec2 = position
        self.size: Vec2 = size
        self.duration: float = duration
        if isinstance(frames, str):
            frames = [frames]
        self.frames: list[str] = frames if frames else []
        self.__load_textures()
        self.loop: bool = loop
        self.current_frame_index: int = 0
        self.elapsed_time: float = 0.0

    def __load_textures(self):
        # Load textures for the animation frames
        self.textures = [load_texture(frame) for frame in self.frames]

    def process(self, delta_time, elapsed_time):
        self.elapsed_time += delta_time
        if self.elapsed_time >= self.duration:
            frame_index = self.current_frame_index + 1
            if frame_index >= len(self.textures):
                if self.loop:
                    frame_index = 0
                else:
                    frame_index = len(self.textures) - 1

            self.current_frame_index = frame_index
            self.elapsed_time = 0.0

    def render(self):
        draw_texture(self.textures[self.current_frame_index], self.position.x, self.position.y, WHITE)


def main():
    # Initialization
    screen_width = 800
    screen_height = 450
    game_tick = GameTick( )
    init_window(screen_width, screen_height, "Pyray Window")


    # load textures
    idle = Animation(
        position=Vec2(100, 100),
        size=Vec2(64, 64),
        duration=0.2,
        frames=[
            "assets/textures/player/adventurer-idle-00.png", 
            "assets/textures/player/adventurer-idle-01.png", 
            "assets/textures/player/adventurer-idle-02.png",
            "assets/textures/player/adventurer-idle-03.png",
            ],
        loop=True
    )
    # Set the target FPS
    set_target_fps(60)

    # Main game loop
    while not window_should_close():
        # Update
        delta_time = get_frame_time()
        elapsed_time = get_time()
        game_tick.update(delta_time)

        idle.process(delta_time, elapsed_time)

        # Draw
        begin_drawing()
        clear_background(RAYWHITE)
        draw_text("Hello, Pyray!", 190, 200, 20, LIGHTGRAY)
        idle.render()
        end_drawing()


    # De-Initialization
    close_window()  # Close window and OpenGL context

if __name__ == "__main__":
    main()